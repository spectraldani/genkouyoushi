<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Test box</title>
</head>

<body>
    <svg width="800" height="800" xmlns="http://www.w3.org/2000/svg" style="display: block;margin: 0 auto;">
    </svg>
    <script type="module">
        import { Box, SpacingRectangle } from "../geometry.js";
        import { makeHanziBox, makeLine, makeBox } from "../svg.js"

        const svg = document.querySelector('svg');
        const SVG_NS = "http://www.w3.org/2000/svg";

        const testWidth = 210;
        const testHeight = 210;
        const gridSize = 5;
        {
            const g = document.createElementNS(SVG_NS, "g");
            const strokeColor = "#aaaaaa";
            svg.setAttribute("viewBox", `0 0 ${testWidth} ${testHeight}`);
            svg.appendChild(g);
            g.setAttribute("stroke-width", (gridSize / 20).toFixed(4));
            for (let i = 0; i <= testWidth / gridSize; i++) {
                g.appendChild(makeLine(
                    i * gridSize, 0, i * gridSize, testHeight, 0,
                    strokeColor
                ));
            }
            for (let i = 0; i <= testHeight / gridSize; i++) {
                g.appendChild(makeLine(
                    0, i * gridSize, testWidth, i * gridSize, 0,
                    strokeColor
                ));
            }
        }

        let origin = [10, 10];
        const baseBox = new Box(10 * gridSize, 10 * gridSize, new SpacingRectangle(0.5), new SpacingRectangle(), gridSize);
        const testBoxFill = "color(srgb 1 0.75 0.8 / 0.5)"

        /* Outer box test */{
            const box = baseBox.clone();
            let [x, y] = origin;
            box.margin = new SpacingRectangle(0.5);

            let hanziBox = makeHanziBox(box, 0, 0, "black", "#aaaaaa", false, false, false, false);
            hanziBox.setAttribute("transform", `translate(${x}, ${y})`);
            svg.appendChild(hanziBox);

            const outerBox = new Box(undefined, undefined);
            outerBox.strokeWidth = 0;
            outerBox.outerHeight = box.outerHeight;
            outerBox.outerWidth = box.outerWidth;
            svg.appendChild(makeBox(outerBox, x, y, "none", testBoxFill))

            x += box.outerWidth + 5;
            box.margin = new SpacingRectangle(0, 0.5);
            hanziBox = makeHanziBox(box, 0, 0, "black", "#aaaaaa", false, false, false, false);
            hanziBox.setAttribute("transform", `translate(${x}, ${y})`);
            svg.appendChild(hanziBox);
            svg.appendChild(makeBox(outerBox, x, y, "none", testBoxFill))

            x += box.outerWidth + 5;
            box.margin = new SpacingRectangle(0.5);
            hanziBox = makeHanziBox(box, 0, 0, "black", "#aaaaaa", false, false, false, false);
            hanziBox.setAttribute("transform", `translate(${x}, ${y})`);
            svg.appendChild(hanziBox);

            let [x0, y0] = [0, 0];
            hanziBox.appendChild(makeBox(new Box(gridSize, gridSize), x0, y0, "none", testBoxFill));

            [x0, y0] = box.innerOrigin;
            hanziBox.appendChild(makeBox(new Box(gridSize, gridSize), x0, y0, "none", testBoxFill))
        }

        origin[1] += baseBox.outerHeight + 5;

        /* Test cross */ {
            const box = baseBox.clone();
            let [x, y] = origin;

            let hanziBox = makeHanziBox(box, 0, 0, "black", "#aaaaaa", true, false, false, false);
            hanziBox.setAttribute("transform", `translate(${x}, ${y})`);
            svg.appendChild(hanziBox);

            const halfBox = new Box(box.innerWidth / 2, box.innerHeight / 2);
            x += box.innerOrigin[0];
            y += box.innerOrigin[1];
            svg.appendChild(makeBox(halfBox, x, y, "none", testBoxFill))
            x += halfBox.innerWidth;
            y += halfBox.innerHeight;
            svg.appendChild(makeBox(halfBox, x, y, "none", testBoxFill))
        }

        origin[1] += baseBox.outerHeight + 5;
        /* Test fourth */ {
            const box = baseBox.clone();
            let [x, y] = origin;

            let hanziBox = makeHanziBox(box, 0, 0, "black", "#aaaaaa", false, false, false, true);
            hanziBox.setAttribute("transform", `translate(${x}, ${y})`);
            svg.appendChild(hanziBox);

            const fourthBox = new Box(box.innerWidth / 4, box.innerHeight / 4);
            x += box.innerOrigin[0];
            y += box.innerOrigin[1];
            for (let i = 0; i < 4; i++) {
                svg.appendChild(makeBox(
                    fourthBox,
                    x + i * fourthBox.innerWidth,
                    y + i * fourthBox.innerHeight,
                    "none", testBoxFill
                ))
            }
        }

    </script>
</body>

</html>